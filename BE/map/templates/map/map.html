<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>실시간 위치 공유</title>
  <!-- 지도 + 거리 계산 지원 -->
  <script type="text/javascript"
          src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=26eee29da19c00b036fbedf652d164f2&libraries=services"></script>
</head>
<body>
  <h1>내 위치</h1>
  <div id="map-wrapper">
    <div id="map"></div>
  </div>
  <style>
    #map-wrapper {
      width: 400px;
      height: 400px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
  
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
  <script>
    const coords = JSON.parse('{{ coords|escapejs }}');
    const centerLat = coords.lat;
    const centerLng = coords.lng;
  
    const mapContainer = document.getElementById('map');
    const mapOption = {
      center: new kakao.maps.LatLng(centerLat, centerLng),
      level: 6  // 대략 30km 반경
    };
  
    const map = new kakao.maps.Map(mapContainer, mapOption);
  
    // 스케줄 위치 마커 (빨간색)
    const scheduleMarker = new kakao.maps.Marker({
      position: new kakao.maps.LatLng(centerLat, centerLng),
      map: map,
      image: new kakao.maps.MarkerImage(
        'http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png',
        new kakao.maps.Size(24, 35)
      )
    });
  
    // 지도에 반경 50km 원형 범위 표시
    const circle = new kakao.maps.Circle({
      center: new kakao.maps.LatLng(centerLat, centerLng),  // 중심 좌표
      radius: 50000,  // 단위: 미터 (50km)
      strokeWeight: 2,  // 선 두께
      strokeColor: '#FF00FF',  // 테두리 색
      strokeOpacity: 0.8,  // 테두리 투명도
      fillColor: '#FFB6C1',  // 채우기 색
      fillOpacity: 0.2  // 채우기 투명도
    });
    // 지도에 원 추가
    circle.setMap(map);

    // 내 위치 표시 (카카오 지도 기본 마커 사용)
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const myLat = position.coords.latitude;
        const myLng = position.coords.longitude;
        const myLoc = new kakao.maps.LatLng(myLat, myLng);

        const myMarker = new kakao.maps.Marker({
          map: map,
          position: myLoc
        });

      }, function (error) {
        alert("위치 정보를 가져올 수 없습니다.");
      });
    } else {
      alert("이 브라우저에서는 위치 정보를 지원하지 않습니다.");
    }
  </script>
</body>
</html>